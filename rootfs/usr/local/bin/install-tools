#!/usr/bin/env sh

box() {
    echo "Installing Box"
    mkdir -p /usr/local/bin/box && wget --no-check-certificate -qO box.phar $(wget -qO- https://api.github.com/repos/box-project/box/releases/latest | grep "browser_download_url.*\.phar" | cut -d : -f 2,3 | tr -d '," ') && mv box.phar /usr/local/bin/box && chmod a+x /usr/local/bin/box/box.phar
}

composer() {
    echo "Installing Composer"
    wget https://raw.githubusercontent.com/composer/getcomposer.org/76a7060ccb93902cd7576b67264ad91c8a2700e2/web/installer -O - -q | php -- --quiet
    mv composer.phar /usr/local/bin/composer
    chmod a+x /usr/local/bin/composer
}

couscous() {
    echo "Installing Couscous"
    mkdir -p /usr/local/bin/couscous && wget --no-check-certificate -qO couscous.phar $(wget -qO- https://api.github.com/repos/CouscousPHP/Couscous/releases/latest | grep "browser_download_url.*\.phar" | cut -d : -f 2,3 | tr -d '," ') && mv couscous.phar /usr/local/bin/couscous && chmod a+x /usr/local/bin/couscous/couscous.phar
}

exakat() {
    echo "Installing Exakat"
    wget -q https://www.exakat.io/versions/index.php?file=exakat-2.6.2.phar -O /usr/local/bin/exakat
    chmod a+x /usr/local/bin/exakat
}

infection() {
    echo "Installing Infection"
    mkdir -p /usr/local/bin/infection && wget --no-check-certificate -qO infection.phar $(wget -qO- https://api.github.com/repos/infection/infection/releases/latest | grep "browser_download_url.*\.phar" | cut -d : -f 2,3 | tr -d '," ') && mv infection.phar /usr/local/bin/infection && chmod a+x /usr/local/bin/infection/infection.phar
}

php_cs_fixer() {
    echo "Installing PHP CS Fixer"
    mkdir -p /usr/local/bin/php-cs-fixer && wget --no-check-certificate -qO php-cs-fixer.phar $(wget -qO- https://api.github.com/repos/PHP-CS-Fixer/PHP-CS-Fixer/releases/latest | grep "browser_download_url.*\.phar" | cut -d : -f 2,3 | tr -d '," ') && mv php-cs-fixer.phar /usr/local/bin/php-cs-fixer && chmod a+x /usr/local/bin/php-cs-fixer/php-cs-fixer.phar
}

phpmd() {
    echo "Installing PHP Mess Detector"
    mkdir -p /usr/local/bin/phpmd && wget --no-check-certificate -qO phpmd.phar $(wget -qO- https://api.github.com/repos/phpmd/phpmd/releases/latest | grep "browser_download_url.*\.phar" | cut -d : -f 2,3 | tr -d '," ') && mv phpmd.phar /usr/local/bin/phpmd && chmod a+x /usr/local/bin/phpmd/phpmd.phar
}

phpstan() {
    echo "Installing PHPStan"
    mkdir -p /usr/local/bin/phpstan && wget --no-check-certificate -qO phpstan.phar $(wget -qO- https://api.github.com/repos/phpstan/phpstan/releases/latest | grep "browser_download_url.*\.phar" | cut -d : -f 2,3 | tr -d '," ') && mv phpstan.phar /usr/local/bin/phpstan && chmod a+x /usr/local/bin/phpstan/phpstan.phar
}

phpunit() {
    echo "Installing PHPUnit"
    wget -q https://phar.phpunit.de/phpunit-10.phar -O /usr/local/bin/phpunit
    chmod a+x /usr/local/bin/phpunit
}

pint() {
    echo "Installing Pint"
    mkdir -p /usr/local/bin/pint && wget --no-check-certificate -qO pint.phar $(wget -qO- https://api.github.com/repos/laravel/pint/releases/latest | grep "browser_download_url.*\.phar" | cut -d : -f 2,3 | tr -d '," ') && mv pint.phar /usr/local/bin/pint && chmod a+x /usr/local/bin/pint/pint.phar
}

psysh() {
    echo "Installing PsySH"
    wget -q https://psysh.org/psysh -O /usr/local/bin/psysh
    chmod a+x /usr/local/bin/psysh
}

watchr() {
    echo "Installing watchr"
    mkdir -p /usr/local/bin/watchr && wget --no-check-certificate -qO watchr.phar $(wget -qO- https://api.github.com/repos/flavioheleno/watchr/releases/latest | grep "browser_download_url.*\.phar" | cut -d : -f 2,3 | tr -d '," ') && mv watchr.phar /usr/local/bin/watchr && chmod a+x /usr/local/bin/watchr/watchr.phar
}

install() {
    box
    composer
    couscous
    [ -n "$WITH_EXAKAT" ] && exakat
    infection
    php_cs_fixer
    phpmd
    phpstan
    phpunit
    pint
    psysh
    [ -z "$WITHOUT_WATCHR" ] && watchr
    echo "Done!"
}

install
